<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML+RDFa 1.0//EN" "http://www.w3.org/MarkUp/DTD/xhtml-rdfa-1.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:foaf="http://xmlns.com/foaf/0.1/" xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:svg="http://www.w3.org/2000/svg" version="XHTML+RDFa 1.0" xml:lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <title>View</title>
    <link rel="stylesheet" href="css/backside.css" type="text/css" media="screen" charset="utf-8"/>
    <script type="text/javascript" charset="utf-8">
    // <![CDATA[
    window.bootstrap = (function() {
      var components = [], scripts = [];
      return { 
        add: function(fun) {components.unshift(fun);},
        tag: function (src) {var s = document.createElement('script'); s.type = 'text/javascript'; s.src = src;return s;},
        queue: function(){for (var i=0; i < arguments.length; i++) {var s = this.tag(arguments[i]); s.onload = this.load; scripts.push(s);}; return this;},
        load: function(){ if (scripts.length > 0) {document.body.appendChild(scripts.shift()); } else { window.bootstrap.init(); } },
        init: function() {components.forEach(function(component) { if (typeof component != 'function') return; component.call(); }); }
    };})();
    bootstrap.queue('js/mootools-core.js', 'js/mootools-more.js', 'js/admin.js');
    window.onload = window.bootstrap.load;
    // ]]>
  </script>
  </head>
  <body>
  <section id="toolbar" class="container">
    <div class="_2 column">
      <p>Welcome, User</p>
    </div>
    <div class="_5 column">
      <p><em id="statistics">Statistics</em></p>
    </div>
    <div class="_3 column">
      <p><time id="timestamp">Preview</time> <button onclick="var p = document.getElementById('preview').contentDocument.body; if (p.className == 'highlighted') {p.className = ''; this.textContent = 'Show Highlighting';} else {p.className = 'highlighted'; this.textContent = 'No Highlighting'} return false;">No Highlighting</button></p>
    </div>
  </section>
  <section class="container">
    <div class="_2 column">
      <div id="tagger"></div>
      <details id="help">
        <summary>Help With Tagging</summary>
        <dl>
          <dt>What are tags for?</dt>
          <dd>Tags are the brain of this operation. In a nutshell, there is copy, some very minimal styling, and heavy tag-age. That said, tags should be significant across episodes and even within an article. For example, 'guitarist' is a good tag because it could be related to another <strong>catagorical tag</strong> such as name[somebody] which will give the query engine lots more to work with.</dd>
          <dt>What is a categorical tag?</dt>
          <dd>categorical tags are prefixed with something other than tag[whatever]; ie artist[whatever], place[whatever], or</dd>
          <dt>What are the tag rules</dt>
          <dd>Tag <em>keywords</em> should be lowercase, always. They have the format <strong>keyword[</strong>Some Text<strong>]</strong></dd>
        </dl>
      </details>
    </div>
    <div id="notebook" class="_5 column">
      <textarea id="selection" class="editing" spellcheck="false">Guitarist and artist[Ohio Players] frontman name[Leroy &#x201C;Sugarfoot&#x201D; Bonner] died of undisclosed causes this week at the age of 69. The group&#x2019;s string of era[&#x2018;70s] albums for label[Westbound] and label[Mercury Records], driven by Bonner&#x2019;s lead vocals and electrifying double-neck guitar work, stands as one of the most impressive runs in funk history. Their distinct sound found new life in the in the late era[&#x2018;80s] and era[&#x2018;90s] as countless genre[hip hop] artists sampled the group&#x2019;s work (a artist[Red Hot Chili Peppers] cover of &#x201C;track[Love Rollercoaster]&#x201D; on the soundtrack for album[Beavis and Butthead Do America]1 didn&#x2019;t hurt either). Greg highlights &#x201C;Skin Tight&#x201D; as prime example of Bonner&#x2019;s musical legacy.

This week the dB&#x2019;s, one of genre[power pop]&#x2019;s great tag[underexposed bands], stops by the tag[Sound Opinions studio] for an interview and a brief live set. The group came together in era[1978] as part of place[New York City]&#x2019;s genre[punk] and genre[new wave] scene, and put out two classic, but minimally distributed albums before singer/guitarist name[Chris Stamey] left the group. Two more low profile records followed before the group tag[broke up]1 in era[1988]. Now the original dB&#x2019;s lineup is back with a tag[new album], album[Falling Off the Sky]. Jim used to frequently go see this band live in their earliest days, and it&#x2019;s clear that they haven&#x2019;t lost a step in their few decades off. During their visit, the band rips through three songs from album[Falling Off the Sky], and Stamey and co-frontman name[Peter Holsapple] talk with Jim and Greg about their early days in place[North Carolina], their label woes in the era[&#x2018;80s], and their decision to reunite not for a paycheck, but just because they were itching to play again. After you hear their interview, check out these two bonus performances: &#x201C;track[Happenstance]&#x201D; and &#x201C;track[Neverland],&#x201D; both from their best ever.</textarea>
    </div>
    <iframe class="_3 column" id="preview" src="preview.html" name="preview_frame" seamless="seamless" width="100%"></iframe>
  </section> 
  
  <div id="network" class="container"></div>

  <script type="text/javascript" charset="utf-8">
    //<![CDATA[
    
    bootstrap.add(function () {
      var tagger = new Ed.tagger('tagger');
      var editor = new Ed.it('selection');
      
      editor.addEvent('textSelect', function (evt) {
        tagger.addTag(this.cursor.getSelectedText(), [this.cursor.start, this.cursor.end]);
      })
      
      editor.addEvent('textInput', function () {
        findMetadata(this.cursor.getText());
      });
      
      editor.macro.addEvent('enter', function() {
        console.log('perform enter stuff');
      });
      
      editor.addEvent('cursor', function () {
        var pos = this.cursor.getPosition();
        if (taglist.index[pos] > 0) {
          var elem = taglist.index[pos];
          tagger.edit(taglist.tags[elem]);
        }
      });
      
      editor.addEvent('ready', function () {
        var size = window.getComputedStyle(this.field, null).getPropertyValue("line-height");
        var bg = btoa("<svg xmlns='http://www.w3.org/2000/svg' width='"+size+"' height='"+size+"' viewBox='0 0 50 50'><line x1='0' y1='50' x2='50' y2='50' stroke='#9DD1EF' fill='none'/></svg>");
        this.field.style.background = 'transparent url(data:image/svg+xml;base64,'+bg+') repeat 0 1px' ;
        this.field.focus();
        findMetadata(this.field.value);
        
      });
    });


    /*

  
  selects_cursor.addEventListener('keyup', function (evt) {
    var startCursor = this.selectionStart;
    switch (evt.keyCode) {
      case 13:
        // enter key, will be tricky
        if (this.selectionStart != this.selectionEnd) {
          var endCursor = this.selectionEnd;
          var selected = this.value.substring(startCursor, endCursor);
          var endIdx  = this.value.length - endCursor;
          var re = new RegExp("([^]{"+startCursor+"})("+selected+")([^]{"+endIdx+"})", 'm');
          this.value = this.value.replace(re, "$1 REPLACE_ME[$2]$3");
        
          this.setSelectionRange(startCursor + 1, endCursor+11 - selected.length);
        }
        break;
    }

  });
  */
  function findMetadata(value) {
    var preview = worker.postMessage(value);
  }
  //]]>
  </script>
  </body>
</html>
